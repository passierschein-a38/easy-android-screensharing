<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/ico/favicon.ico">

    <title>Mobile Support</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<script type="text/javascript" src="Broadway/Player/YUVWebGLCanvas.js" ></script>
	<script type="text/javascript" src="Broadway/Player/Player.js" ></script>
  </head>
    
    <body>
	<div id="page">
	
		<div class="container">
		
			<div class="row">
			<div class="col-md-4"></div>
			<div class="col-md-4">
			
			<br/>
				<div id="messages"></div>
				
			</div>
			</div>
			
			<div class="row">
			
				<div class="col-md-4">
					
				</div>
			
				<div class="col-md-4">
					<h3>Mobile Support</h3>				
				</div>
			</div>
			
			<div class="row">
				<div class="col-md-4">					
				</div>

			<div class="col-md-4">
			
				<div id="player">
				
				</div>
				
				<div id="form">			
					<form onsubmit="return false;">
						<div class="form-group">
							<label for="pinCode"></label>
							<input type="text" class="form-control" id="pinCode" placeholder="Please Enter Pin Code">
						</div>
						<button onclick="connect();" type="submit" class="btn btn-default">Connect</button>
					</form>
				</div>
			</div>
			
		</div>
		        
</div>

        
<!-- ****************************************************************************************************************************************
FOOTER
********************************************************************************************************************************************* -->        
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    
    <!--BACKSTRETCH-->
    <!-- You can use an image of whatever size. This script will stretch to fit in any screen size.-->
    <script type="text/javascript" src="assets/js/jquery.backstretch.min.js"></script>
    <script>
	
		function pushNotification( msg ){
			var tpl = '<div class="alert alert-warning">';
				tpl    += '<a href="#" class="close" data-dismiss="alert">&times;</a>';
				tpl    += msg;
				tpl    += '</div>';
						
				$('#messages').html( tpl );
		}
	
        $.backstretch("assets/img/bg01.jpg", {speed: 500});
		$('#player').hide();
		p = new Player({
		useWorker: true,
		workerFile: 'Broadway/Player/Decoder.js',  
		});

		document.player = p;
		
		var connection = new WebSocket('ws://localhost:5000');
		connection.binaryType = 'arraybuffer';
		
						
connection.onopen = function () {
  
};

connection.onerror = function (error) {
    
};

connection.onclose = function (evt) {
    $('#player').hide();				
	$('#form').show();		
	pushNotification( 'Connection lost to server' );
};

connection.onmessage = function (e) { 

	if( typeof e.data == 'object' ){
		var bytearray = new Uint8Array(e.data);
		document.player.decode( bytearray );  
		return;
	}else{
		var cmd = JSON.parse( e.data );

		console.log( cmd );
			
		switch( cmd.id ){
			case 100:	//shower start
				$('#player').append( document.player.canvas );
				$('#player').show();
				$('#form').hide();				
				break;
			case 200:	//shower stop
				$('#player').hide();				
				$('#form').show();				
				pushNotification( 'Sharing stopped by peer' );
				break;	
			case 300:				
				pushNotification( cmd.text );			
				break;
		}
		
	}
};

function connect(){
	var pin = $('#pinCode').val();
	connection.send( pin );	
    return false;	
}
    </script>    
	

  </body>
</html>
